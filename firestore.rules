rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Note: Server-side API routes use client SDK, so request.auth is null
    // Security is enforced by API routes using requireAuth() and userId filtering
    // All API routes use where("userId", "==", userId) queries to ensure data isolation
    
    // Documents collection - API routes enforce userId filtering
    match /documents/{documentId} {
      // Allow read/write - API routes enforce security via userId filtering
      allow read, write: if true;
    }
    
    // OCR results collection - API routes enforce userId filtering
    match /ocr_results/{ocrId} {
      allow read, write: if true;
    }
    
    // Summaries collection - API routes enforce userId filtering
    match /summaries/{summaryId} {
      allow read, write: if true;
    }
    
    // Checklists collection - API routes enforce userId filtering
    match /checklists/{checklistId} {
      allow read, write: if true;
    }
    
    // Calendar events collection - API routes enforce userId filtering
    match /calendarEvents/{eventId} {
      allow read, write: if true;
    }
    
    // Chat conversations collection - API routes enforce userId filtering
    match /conversations/{conversationId} {
      allow read, write: if true;
    }
    
    // Chat conversations collection (alternative name) - API routes enforce userId filtering
    match /chatConversations/{conversationId} {
      allow read, write: if true;
    }
    
    // Chat messages collection - API routes enforce userId filtering
    match /messages/{messageId} {
      allow read, write: if true;
    }
    
    // Chat messages collection (alternative name) - API routes enforce userId filtering
    match /chatMessages/{messageId} {
      allow read, write: if true;
    }
    
    // Canonical data collection - API routes enforce userId filtering
    match /canonical_data/{documentId} {
      allow read, write: if true;
    }
    
    // Privacy settings collection - API routes enforce userId filtering
    match /privacy_settings/{userId} {
      allow read, write: if true;
    }
    
    // User privacy settings collection (alternative name) - API routes enforce userId filtering
    match /user_privacy_settings/{userId} {
      allow read, write: if true;
    }
    
    // Retention records collection - API routes enforce userId filtering
    match /retention_records/{documentId} {
      allow read, write: if true;
    }
    
    // Document retention collection - API routes enforce userId filtering
    match /document_retention/{documentId} {
      allow read, write: if true;
    }
    
    // Deny all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

